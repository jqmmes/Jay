syntax = "proto3";

option java_package = "pt.up.fc.dcc.hyrax.odlib.protoc";
option java_outer_classname = "ODProto";
import "google/protobuf/empty.proto";


message Box {
    float top_1 = 1;
    float top_2 = 2 ;
    float bottom_1 = 3;
    float bottom_2 = 4;
}

message Detection {
    float score = 1;
    Box box = 2;
    int32 class = 3;
}

message Job {
    int64 id = 1;
    bytes data = 2;
}

message JobResults {
    repeated Detection detections = 1;
    int64 id = 2;
}

message Status {
    int32 code = 1;
}

message Models {
    repeated Model models = 1;
}

message Model {
    int32 id = 1;
    string name = 2;
    string url = 3;
    bool downloaded = 4;
}

message RemoteClient {
    int64 id = 1;
    string address = 2;
    int32 port = 3;
}

message ModelConfig {
    Model model = 1;
    map<string, string> configs = 2;
}

message AsyncRequest {
    Job job = 1;
    RemoteClient remoteClient = 2;
}

message DeviceStatus {
    int32 battery = 1;
    int32 batteryStatus = 2;

    int32 cpuCores = 3;
    int32 queueSize = 4;
    int32 runningJobs = 5;
    int32 pendingJobs = 6;

    int32 connections = 7;
}

service ODCommunication {
    rpc putJobAsync (AsyncRequest) returns (Status) {};
    rpc putResultAsync (JobResults) returns (Status) {};
    rpc putJobSync (Job) returns (JobResults) {};
    rpc listModels (google.protobuf.Empty) returns (Models) {};
    rpc selectModel (Model) returns (Status) {};
    rpc configModel (ModelConfig) returns (Status) {};
    rpc ping (google.protobuf.Empty) returns (google.protobuf.Empty) {};
    rpc sayHello (RemoteClient) returns (Status) {};
    rpc getStatus (google.protobuf.Empty) returns (DeviceStatus);
}